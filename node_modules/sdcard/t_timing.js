var fs = null,
    data = Buffer(60*1024);

if (0) {
  var vol = require("fatfs/img_volume.js").createDriverSync("/Users/natevw/Desktop/fat32.img"),
      fs = require('fatfs').createFileSystem(vol, {umask:0020, uid:99, gid:42});
  writeData();
} else {
  var sd = require("./").use(require('tessel').port['A'], {getFilesystems:true}),
      fs = null;
  sd.on('ready', function (fss) {
    fs = fss[0];
    writeData();
  });
}

function writeData() {
  setImmediate(function () {
    var t1 = Date.now();
    //process.stdout.write("--> Writing "+t1+"â€¦\t");
    fs.writeFile("sample-"+t1+".bin", data, function (e) {
      var t2 = Date.now();
      console.log(t2 - t1);
      writeData();
    });
  });
}
